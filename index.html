<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Tagshop AI & Product Search</title>
<link rel="stylesheet" href="uniform-dark-glass.css">
<style>
:root { --glass: rgba(0,0,0,0.35); --stroke: rgba(255,255,255,0.12); --text:#fff; --muted:#cfcfcf; --accent:#ffe169; }
body { font-family: system-ui; background:#000; color:#fff; margin:0; padding:0; transition: background 0.3s, color 0.3s;}
body.light { background:#f0f0f0; color:#000; }
h1 { text-align:center; padding:20px 0; margin:0; }
.container { display:flex; min-height:calc(100vh - 60px); }
.filters { width:220px; background:var(--glass); padding:20px; border-right:1px solid var(--stroke); box-sizing:border-box; }
.filters h2 { font-size:16px; margin-bottom:10px; }
.filters select, .filters input, .filters button { width:100%; margin-bottom:12px; padding:8px; border-radius:6px; border:1px solid var(--stroke); background: rgba(255,255,255,0.06); color: var(--text); }
.filters button { background:#000; font-weight:700; cursor:pointer; }
.results { flex:1; padding:20px; overflow-y:auto; box-sizing:border-box; }
.grid { display:grid; grid-template-columns: repeat(auto-fill,minmax(150px,1fr)); gap:12px; }
.product { background: var(--glass); border:1px solid var(--stroke); border-radius:12px; padding:10px; text-align:center; cursor:pointer; }
.product img { max-width:100%; border-radius:6px; transition: transform 0.2s; }
.product.expanded img { transform: scale(2); z-index:2; position:relative; }
.product-btns { display:flex; justify-content:center; gap:4px; margin-top:6px; }
.product-btns button { padding:4px 6px; border-radius:12px; font-size:11px; background:#000; color:#fff; cursor:pointer; }
#toggle-theme { position:absolute; top:10px; right:10px; padding:8px 12px; border-radius:6px; font-weight:700; cursor:pointer; }
</style>
</head>
<body>

<h1>Tagshop</h1>
<button id="toggle-theme">Toggle Light/Dark</button>

<div class="container">
  <!-- FILTERS SIDE PANEL -->
  <div class="filters">
    <h2>Search Products</h2>
    <input type="text" id="search-query" placeholder="Enter product..." />
    <select id="category-filter">
      <option value="">All Categories</option>
      <option value="electronics">Electronics</option>
      <option value="clothing">Clothing</option>
      <option value="home">Home</option>
      <option value="books">Books</option>
    </select>
    <select id="shop-filter">
      <option value="">All Shops</option>
      <option value="amazon">Amazon</option>
      <option value="temu">Temu</option>
      <option value="alibaba">Alibaba</option>
      <option value="lazada">Lazada</option>
    </select>
    <button id="search-run">Search</button>
  </div>

  <!-- RESULTS GRID -->
  <div class="results">
    <div id="search-results"></div>
  </div>
</div>

<script src="https://js.puter.com/v2/"></script>
<script>
const API_KEY = "AIzaSyB9YwW8EVXQJsVwSMbJrk-NU9B9ZrzzkGs"; 
const CSE_ID = "f7e219616fe1d4629"; 

const searchResults = document.getElementById("search-results");

document.getElementById("toggle-theme").addEventListener("click", ()=>{
  document.body.classList.toggle("light");
});

/* SEARCH FUNCTION: clears previous results each time */
document.getElementById("search-run").addEventListener("click", async ()=>{
  const query = document.getElementById("search-query").value.trim();
  const category = document.getElementById("category-filter").value;
  const shop = document.getElementById("shop-filter").value;

  if(!query){ searchResults.innerHTML="Enter a search term."; return; }

  // Clear previous results
  searchResults.innerHTML = "Searching...";

  try{
    let fullQuery = query;
    if(category) fullQuery += ` ${category}`;
    if(shop) fullQuery += ` ${shop}`;

    const res = await fetch(`https://www.googleapis.com/customsearch/v1?key=${API_KEY}&cx=${CSE_ID}&q=${encodeURIComponent(fullQuery)}`);
    const data = await res.json();

    searchResults.innerHTML = ""; // clear old results
    const grid = document.createElement("div");
    grid.className = "grid";

    if(data.items?.length){
      data.items.forEach(item=>{
        const thumb = item.pagemap?.cse_image?.[0]?.src || 'https://via.placeholder.com/100';
        const div = document.createElement("div");
        div.className = "product";
        div.dataset.shop = shop || 'all';
        div.dataset.category = category || 'all';

        div.innerHTML = `
          <img src="${thumb}" onclick="window.open('${item.link}','_blank')" />
          <div style="font-size:12px; margin-top:4px;">${item.title}</div>
          <div class="product-btns">
            <button onclick="addToWall('${item.title}','${thumb}','${item.link}')">Add to Wall</button>
          </div>
        `;
        grid.appendChild(div);
      });
      searchResults.appendChild(grid);
    } else {
      searchResults.innerHTML = "No results found.";
    }

    // Optional: reset filters after search
    document.getElementById("category-filter").value = "";
    document.getElementById("shop-filter").value = "";

  } catch(e){
    searchResults.innerHTML = "Search error.";
    console.error(e);
  }
});

/* WALL HANDLING */
function addToWall(title, thumb, link){
  const wall = JSON.parse(localStorage.getItem("productWall")||"[]");
  wall.push({title, thumb, link});
  localStorage.setItem("productWall", JSON.stringify(wall));
  alert(`Added to wall: ${title}`);
}
</script>
</body>
</html>
